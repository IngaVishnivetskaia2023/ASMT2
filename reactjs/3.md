
## Handling Side Effects

### What‚Äôs the Problem?
Before exploring a solution, it‚Äôs important to first understand the concrete problem.

Actions **that are not directly related to producing a (new) user interface state often clash with React‚Äôs component rendering cycle**. They may introduce bugs or even break the entire web app.

Consider the following example code snippet (important: don‚Äôt execute this code as it will cause an infinite loop and send a large number of HTTP requests behind the scenes):

```
import { useState } from 'react';
import classes from './BlogPosts.module.css';
async function fetchPosts() {
  const response = await fetch('https://jsonplaceholder.typicode.com/posts');
  const blogPosts = await response.json();
  return blogPosts;
}
function BlogPosts() {
  const [loadedPosts, setLoadedPosts] = useState([]);
  fetchPosts().then((fetchedPosts) => setLoadedPosts(fetchedPosts));
  return (
    <ul className={classes.posts}>
      {loadedPosts.map((post) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  );
}
export default BlogPosts;
```

So what‚Äôs the problem with this code? Why does it create an infinite loop?

In this example, a React component (`BlogPosts`) is created. In addition, a non-component function (`fetchPosts()`) is defined. 
That function uses the built-in `fetch()` function (provided by the browser) to send an HTTP request to an external application programming interface (API) and fetch some data.

In the preceding code snippet, the `BlogPosts` component utilizes `useState()` to register a `loadedPosts` state value. 
The state is used to output a list of blog posts. Those blog posts are not defined in the app itself though. Instead, they are fetched from the external API mentioned in the note box.

`fetchPosts()`, which is the utility function that contains the code for fetching blog posts data from that backend API using the built-in `fetch()` function, is called directly in the component function body. 
Since `fetchPosts()` is an async function (using `async/await`), it returns a **promise**. 
In `BlogPosts`, the code that should be executed once **the promise resolves** is registered via the built-in `then()` method.

‚ùó 
#### Note

`async/await` is **not used directly in the component function body** because regular React components **must not be async functions**. 
Such functions automatically return a promise as a value (even without an explicit return statement), which is an **invalid** return value for a React component.

That being said, there are indeed React components that are allowed to use async/await and return a promise. 
So-called **React Server Components** are not restricted to returning JSX code, strings, etc. 
This feature will be discussed in detail in Chapter 16, React Server Components & Server Actions.

Once the `fetchPosts()` promise resolves, the extracted posts data (`fetchedPosts`) is set as the new `loadedPosts` state (via `setLoadedPosts(fetchedPosts)`).

If you were to run the preceding code (which you should not do!), it would at first seem to work. But behind the scenes, it would **actually start an infinite loop, hammering the API with HTTP requests**. 
This is because, as a result of getting a response from the HTTP request, `setLoadedPosts()` is used to set a new state.

Earlier in this book (in Chapter 4, Working with Events and State), you learned that **whenever the state of a component changes, React re-evaluates the component to which the state belongs**. 
‚ÄúRe-evaluating‚Äù simply means that the component function is executed again (by React, automatically).

Since this `BlogPosts` component calls `fetchPosts()` (which sends an HTTP request) directly inside the component function body, this HTTP request will be sent every time the component function is executed. 
And as the state (`loadedPosts`) is updated as a result of getting a response from that HTTP request, this process begins again, and an infinite loop is created.

The root problem, in this case, is that **sending an HTTP request is a side effect**‚Äîa concept that will be explored in greater detail in the next section.

### Understanding Side Effects
Side effects are actions or processes that occur in addition to another main process. 
At least, this is a concise definition that helps with understanding side effects in the context of a React app.

üóíÔ∏è If you want to dive deeper into the concept of side effects, you can also explore the following discussion about side effects on Stack Overflow: https://softwareengineering.stackexchange.com/questions/40297/what-is-a-side-effect.
